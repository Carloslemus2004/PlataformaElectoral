<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Electoral - Lempira</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    header { display: flex; align-items: center; gap: 20px; }
    .logo { height: 60px; }
    h1 { font-size: 24px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f0f0f0; }
    input[type="number"] { width: 60px; }
    button { margin-top: 10px; padding: 6px 12px; }
  </style>
</head>
<body>
  <header>
    <img src="assets/img/logo.png" alt="Logo Plataforma" class="logo">
    <h1>Dashboard Electoral - Departamento de Lempira</h1>
  </header>

  <table id="tabla">
    <thead><tr></tr></thead>
    <tbody></tbody>
  </table>

  <button id="exportar">Exportar Resultados</button>

  <div id="resumen">Total de votos: 0</div>

  <script>
    fetch('candidatos.json')
      .then(res => res.json())
      .then(candidatos => {
        const tabla = document.getElementById('tabla');
        const encabezado = tabla.querySelector('thead tr');
        encabezado.innerHTML = '<th>Mesa</th>';

        candidatos.forEach(c => {
          encabezado.innerHTML += `
            <th>
              <img src="${c.img}" alt="${c.name}" width="32"><br>
              ${c.name}<br><small>${c.partido}</small>
            </th>
          `;
        });

        const cuerpo = tabla.querySelector('tbody');
        cuerpo.innerHTML = '';

        for (let i = 1; i <= 10; i++) {
          let fila = `<tr><td>Mesa ${i}</td>`;
          candidatos.forEach(() => {
            fila += `<td><input type="number" min="0" value="0" onchange="actualizarTotal()"></td>`;
          });
          fila += '</tr>';
          cuerpo.innerHTML += fila;
        }

        document.getElementById('exportar').onclick = () => {
          let csv = 'Mesa';
          candidatos.forEach(c => {
            csv += `,${c.name}`;
          });
          csv += '\n';

          const filas = tabla.querySelectorAll('tbody tr');
          filas.forEach(fila => {
            const celdas = fila.querySelectorAll('td');
            let linea = celdas[0].textContent;
            for (let i = 1; i < celdas.length; i++) {
              const input = celdas[i].querySelector('input');
              linea += `,${input.value}`;
            }
            csv += linea + '\n';
          });

          const blob = new Blob([csv], { type: 'text/csv' });
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = 'resultados.csv';
          link.click();
        };
      });

    function actualizarTotal() {
      const inputs = document.querySelectorAll('#tabla input');
      let total = 0;
      inputs.forEach(input => {
        total += parseInt(input.value) || 0;
      });
      document.getElementById('resumen').textContent = `Total de votos: ${total}`;
    }
  </script>
</body>
</html>
